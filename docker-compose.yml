services:  
  rabbitmq:
    container_name: rabbitmq
    image: rabbitmq:3-management
    ports:
      - 5672:5672
      - 15672:15672
  
  redis:
    container_name: redis                                                            
    image: redis
    ports:
      - "6379:6379"

  # Handle API Calls
  # worker:
  #   container_name: crnn-worker
  #   build:
  #     dockerfile: api/Dockerfile
  #     context: .
  #   command: sh -c "cd api && uvicorn app:app --host 0.0.0.0 --port 7777 & cd ../ & celery -A celery_tasks.app_worker worker -l INFO --pool=solo"
  #   volumes:
  #     - .:/app
  #   ports:
  #     - "7777:7777"

  webapp:
    container_name: crnn-webapp
    build: 
      dockerfile: webapp/Dockerfile
      context: .
    command: sh -c "cd /app && uvicorn app:app --host 0.0.0.0 --port 80 --reload"
    volumes:
      - ./webapp:/app

    ports:
      - "5555:80"